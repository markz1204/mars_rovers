<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Mars Rovers</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="LineReader.js"></script>
	<script>
	$(document).ready(function(){
		
		$("#localFileSection").hide();
		$("#textAreaSection").hide();
		
		$("input[name='inputSource']").change(function(){

			var value = $( this ).val();
			
			if('localFile' === value){
				$("#localFileSection").show();
				$("#textAreaSection").hide();
			}else{
				$("#localFileSection").hide();
				$("#textAreaSection").show();
			}
		});
		
		$("#fileInput").change(function(){
			var file = this.files[0];
			var textType = /text.*/;

			if (file.type.match(textType)) {
				/*
				var reader = new FileReader();

				reader.onload = function() {
					$("#fileDisplayArea").text(reader.result);
					//alert(reader.result.split(/[\r\n]+/g).length);
				}

				reader.readAsText(file);
				*/
				
				// Create a new instance of the LineReader
				var lr = new LineReader();

				var totalCount = 1;
				var $output = $('#fileDisplayArea');

				lr.on('line', function (line, next) {
				  $output.text($output.text() + '\n' + totalCount + ': ' + line);

				  totalCount++;

				  /**
				   * Simulate some sort of asynchronous operation
				   */
				  setTimeout(function () {
					next();
				  }, 100);
				});

				lr.on('error', function (err) {
				  console.log(err);
				});

				lr.on('end', function () {
				  console.log('Read complete!');
				});

				lr.read(file);
			} else {
				$("#fileDisplayArea").innerText = "File not supported!";
			}
		});
	});
	</script>
</head>
<body>
	<div id="page-wrapper">

		<h3>Please choose an input source:</h3>
		<form>
		  <input type="radio" name="inputSource" value="localFile">Local file<br>
		  <input type="radio" name="inputSource" value="textArea">Text area<br>
		</form>
		<div id="localFileSection">
			<input type="file" id="fileInput">
			<pre id="fileDisplayArea"><pre>
		</div>
		<div id="textAreaSection">
			<textarea id="textAreaInput" rows="15" cols="60"></textarea>
		</div>
	</div>
	
	<script src="textProcess.js"></script>
</body>
</html>
